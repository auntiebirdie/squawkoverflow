<%- include('../header.ejs') %>

  <%- include('../partials/page-title.ejs', {
      title: locals.page == 'gift' ? {
        text : `Send Gift to ${member.username}`
      } : {
        text: member.username,
        url: `/members/${member.id}`,
        append: "'s Aviary"
      }
    })
  %>

  <% if (locals.page == 'gift' && member.settings.privacy_gifts_unwishlisted) { %>
    <div class="text-center"><strong>NOTE</strong> - <%= member.username %> is not accepting gifts of birds not on their wishlist as this time.</div>
  <% } %>

  <%- include('../partials/pagination.ejs') %>

  <div id="lazyLoader" class="row g-0" data-endpoint="aviary" data-params='{"member":"<%= locals.page == 'gift' ? loggedInUser.id : member.id %>","memberData":"<%= locals.page == 'gift' ? member.id : (locals.loggedInUser ? loggedInUser.id : '') %>"}'></div>

  <%- include('../partials/pagination.ejs') %>

  <%- include('../scripts/lazyloader.ejs', { paginate : currentPage, noun: 'birdypet' }) %>

 <% if (locals.loggedInUser) { %>
  <%- include('../partials/editModal.ejs') %>
  <%- include('../partials/giftModal.ejs', { selectedMember : locals.page == 'gift' ? member : null }) %>

  <script>
    $(document).ready(() => {
      $('#lazyLoader').on('click', '.birdypet-actions button[data-action]', (e) => {
        var button = e.currentTarget;
        var action = button.getAttribute('data-action');

        if (!button.disabled) {
          button.setAttribute('disabled', true);
          button.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>';

          switch (button.getAttribute('data-action')) {
            case "release":
              API.call('release', 'POST', {
                birdypet : button.getAttribute('data-id')
              },
              function(data) {
                button.innerHTML = 'ðŸ‘‹';
                button.removeAttribute('disabled');
                let birdypetContainer = $('.birdypet-container[data-id="' + button.getAttribute('data-id') + '"]');
                birdypetContainer.css('opacity', .5).find('.birdypet-actions').remove();
                birdypetContainer.find('a').removeAttr('href');
              }
            );
            break;
          }
        }
      });
    });
  </script>
 <% } %>

<%- include('../footer.ejs') %>
