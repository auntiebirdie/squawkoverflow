<%- include('../header.ejs') %>

  <%- include('../partials/page-title.ejs', { title : "Birdypedia" }) %> 

 <% if (locals.loggedInUser) { %>
  <div class="text-center">
    <p>
      <em>Click on an individual bird's wishlist indicator to cycle through the following options:</em>
    </p>
    <p>
      <span class="me-3">🤍  Not on wishlist</span>
      <span class="me-3">❤️  Wanted</span>
      <span class="me-3">🌟 Needed</span>
    </p>

    <p class="small">
      <em>(<a href="/faq#wishlist">Wait, what is the wishlist and want vs. need for?</a>)</em>
    </p>
  </div>

  <div id="gottaWishlistEmAll" class="mt-5 text-center">
    Add all birds in these results: &nbsp;
    <span>
      <button data-action="want" class="btn btn-dark btn-sm" role="button">❤️</button>
      &nbsp;
      <button data-action="need" class="btn btn-dark btn-sm" role="button">🌟</button>
      &nbsp;
      <button data-action="none" class="btn btn-dark btn-sm" role="button">🤍</button>
    </span>
    <br>
    <small><em>(This may take a while; please be patient!)</em></small>
  </div>
 <% } %>

  <%- include('../partials/happy-birthday.ejs') %>

  <%- include('../partials/pagination.ejs') %>

  <div id="lazyLoader" class="row g-0" data-endpoint="birdypedia"></div>

  <%- include('../partials/pagination.ejs') %>

  <%- include('../scripts/lazyloader.ejs', { template: '../templates/birdypedia.ejs', paginate: currentPage }) %>

  <script type="text/javascript">
    $('#lazyLoader').on('click', '.birdypet.mini[data-bg]', function (event) {
      var variant = event.target;
      var full = variant.parentNode.parentNode.parentNode.querySelector('.birdypet');
      full.style.backgroundImage = variant.style.backgroundImage;
    });

   <% if (locals.loggedInUser) { %>
    $('#gottaWishlistEmAll').on('click', '.btn', function (event) {
      let button = event.target;
      let species = [];

      if (!button.style.opacity) { 
        $('.btn', '#gottaWishlistEmAll').css('opacity', .5);
        $('.wishlist-heart', '#lazyLoader').css('opacity', .5).html('⏳');

        $('.wishlist-heart', '#lazyLoader').map((index, btn) => species.push(btn.getAttribute('data-id')));

        API.call('wishlist', 'POST', {
          action: button.getAttribute('data-action'),
          search : $('#search').val(),
          <%- locals.searchFields ? `searchField: $('#searchField').val(),` : '' %>
          <%- locals.filters ? `filters : Array.from($('input:checked', '#filters')).map((checkbox) => checkbox.value),` : '' %>
          <%- locals.families ? `family : $('#family').is(':visible') ? $('#family').val() : '',` : '' %>
          <%- locals.flocks ? `flocks : flocks ? flocks : '',` : '' %>
          <%- locals.artist ? `artist : "${artist.name}",` : '' %>
          <%- locals.style ? `style : $('#style').is(':visible') ? $('#style').val() : '',` : '' %>
          <%- locals.egg ? `adjectives : "${egg.adjective}",` : '' %>
        }, function (data) {
          $('.wishlist-heart', '#lazyLoader').css('opacity', '').html(data);
          $('.btn', '#gottaWishlistEmAll').css('opacity', '');
        });
      }
    });
   <% } %>
  </script>
<%- include('../footer.ejs') %>
