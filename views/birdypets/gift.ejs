<%- include('../header.ejs') %>

    <%- include('../partials/page-title.ejs', { breadcrumb : "BirdyPets", title : "Gifting" }) %>

    <div class="row">
      <div class="col-md-6">
        <h4><%= giftpet.nickname? `"${giftpet.nickname}" (${giftpet.birdypet.species.commonName})` : `${giftpet.birdypet.species.commonName}   ${giftpet.birdypet.version} ${giftpet.birdypet.label}` %></h4>

        <div class="card mt-4 mb-4">
          <div class="birdypet" style="background-image: url('https://storage.googleapis.com/birdypets/<%= giftpet.birdypet.species.order %>/<%= giftpet.birdypet.species.family %>/<%= giftpet.birdypet.species.scientificName %>/<%= giftpet.birdypet.id %>.jpg');"></div>
        </div>
      </div>
      <div class="col-md-6">
        <h4>Who is the lucky person to receive this gift?</h4>

        <input class="form-control" list="memberListOptions" id="memberList" placeholder="Pick a member..." autocomplete="off">
        <datalist id="memberListOptions">
        <% for (var member of members) { %>
          <option value="<%= member.id %>" data-avatar="<%= member.avatar %>">
            <%= member.username %>
          </option>
        <% } %>
        </datalist>

        <div id="memberDisplay" class="mt-3"></div>
      </div>
    </div>

    <div class="row">
      <form id="giftBirdyPet" method="post" class="text-center">
        <input id="giftTo" name="member" type="hidden">
        <button id="actionButton" class="btn btn-primary" type="submit" disabled>Send Gift!</button>
      </form>
    </div>

    <script type="text/javascript">
      var actionButton = $('#actionButton');
      var memberDisplay = $('#memberDisplay');

      $('#memberList').on('input', function () {
        var value = this.value;
        var option = $('#memberListOptions option[value="' + value + '"]')[0];

        try {
          $('#giftTo').val(value);

          memberDisplay.html(`<h3><img src="https://cdn.discordapp.com/avatars/${option.value}/${option.getAttribute('data-avatar')}.webp?size=64" class="member-avatar"> ${option.innerText}</h3>`);

          actionButton.attr('disabled', false);
        }
        catch (err) {
$('#giftTo').val("");
          memberDisplay.html("");
          actionButton.attr('disabled', true);
        }
      });
    </script>

<%- include('../footer.ejs') %>
