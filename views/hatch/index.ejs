<%- include('../header.ejs') %>

  <div id="eggs">
    <%- include('../partials/page-title.ejs', { title : "Hatch Eggs" }) %>

   <% if (loggedInUser.supporter) { %>
    <div class="row">
      <div class="col-12 pb-3 text-end">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="discoveredDisplay" id="discoveredDisplayPercent" value="percent">
          <label class="form-check-label" for="discoveredDisplayPercent">%</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="discoveredDisplay" id="discoveredDisplayFraction" value="fraction">
          <label class="form-check-label" for="discoveredDisplayFraction">‚ÅÑ</label>
        </div>
      </div>
    </div>
   <% } %>

    <div class="row text-center mb-5">
      <% if (eggs.length > 0) { %>
        <% for (var egg of eggs) { %>
        <div class="col-6 col-md-4 col-lg-2 mb-3">
          <a data-egg="<%= egg.adjective %>" class="mb-2 egg" role="button">
            <h3>
              <img src="https://storage.googleapis.com/squawkoverflow/<%= egg.icon || 'eggs/D/default.png' %>">
            </h3>
            <h4><%= egg.adjective %></h4>
          </a>
         <% if (loggedInUser.supporter) { %>
          <h5 class="text-muted discovered-amount" data-discovered="<%= egg.numHatched %>" data-total="<%= egg.numSpecies %>">
            <%= egg.numHatched %>/<%= egg.numSpecies %>
          </h5>
         <% } %>
         <% if (egg.isEvent) { %>
          <h6 class="small">üéâ This egg can hatch a special event bird!</h6>
         <% } %>
         <% if (egg.isNeeded) { %>
          <h6 class="small">üåü This egg can hatch a bird you need!</h6>
         <% } else if (egg.isWanted) { %>
          <h6 class="small">‚ù§Ô∏è This egg can hatch a bird you want!</h6>
         <% } %>
        </div>
        <% } %>
      <% } else if (loggedInUser.settings.general_removeCompleted) { %>
        <p><em>You appear to have collected every species from every egg!  To hatch more eggs anyway, head to <a href="/settings">Settings</a> and uncheck the "remove completed eggs" option.</em></p>
      <% } else { %>
        <p><em>Something went wrong!  Please <a href="https://bugs.squawkoverflow.com/?member=<%= loggedInUser.id %>" target="_blank">submit a bug report</a> so someone can look into it.</em></p>
      <% } %>
    </div>

    <% if (member.hasIncubator) { %>
      <div class="text-center">
        <p><em>You can hatch special eggs containing specific birds!  Go to the <a href="/hatch/incubator">incubator</a> to view them.</em></p>
      </div>
    <% } %>

    <div class="row text-center mt-5">
      <div class="col">
        <p><small><em><a href="/faq#weird-eggs" target="_blank">What's with the weird eggs?</a></em></small></p>
       <% if (loggedInUser.supporter) { %>
        <p><small><em><a href="/faq#extra-insights" target="_blank">What do the numbers below the eggs mean?</a></em></small></p>
       <% } %>
      </div>
    </div>
  </div>

  <div id="hatched" class="d-none">
    <%- include('../partials/page-title.ejs', { title : "You hatch the %adjective% egg to discover..." }) %>

    <%- include('../partials/hatch.ejs') %>
  </div>

  <%- include('../scripts/hatch.ejs', { page : 'hatch' }) %>
  <%- include('../scripts/membersearch.ejs', { privacy: ['gifts'], include: ['birdData', 'lastActive'] }) %>

  <%- include('../partials/editModal.ejs') %>

  <script type="text/javascript">
    $(document).ready(function () {
      $('input[name="discoveredDisplay"]').on('change', updateDisplay);

      $('input[name="discoveredDisplay"][value="' + (sessionStorage.getItem('discoveredDisplay') || 'fraction') + '"]').click();
    });

    function updateDisplay () {
      let display = $('input[name="discoveredDisplay"]:checked').val();

      sessionStorage.setItem('discoveredDisplay', display);

      $('.discovered-amount').each((i, amount) => {
        switch (display) {
          case 'percent':
            amount.innerHTML = Math.floor(amount.getAttribute('data-discovered') / amount.getAttribute('data-total') * 100) + '%';
            break;
          case 'fraction':
            amount.innerHTML = amount.getAttribute('data-discovered') + '/' + amount.getAttribute('data-total') ;
            break;
        }
      });
    }
  </script>

<%- include('../footer.ejs') %>
