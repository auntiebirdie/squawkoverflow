<%- include('../header.ejs') %>

    <%- include('../partials/page-title.ejs', {
          title : {
            url: `/members/${member.id}`,
            text: member.username,
            append: "'s Wishlist"
          }
    }) %>

    <% if (locals.loggedInUser && loggedInUser.id == member.id && member.hasWishlist) { %>
      <div class="bg-light rounded w-75 mx-auto mb-4 p-4 text-center">
       <% if (member.baitUsed) { %>
        <p class="mb-0"><em>You have already attracted a bird to your aviary today.  Try again in <%= timeUntilTomorrow %>!</em></p>
       <% } else if (member.bugs > 0) { %>
        <p><em>You have <strong><%= member.bugs %> bug<%= member.bugs == 1 ? "" : "s" %></strong> available.  Once per day, you can use one to attract a random bird from your wishlist to live in your aviary!</em></p>

        <button id="useBait" class="btn btn-dark">ğŸ›  Here, birdy, birdy...</button>
       <% } else { %>
        <p class="mb-0"><em>You don't have any bugs available to use as bait! You can find them randomly while wandering the site or receive them as a reward for <a href="https://trello.com/add-card?name=%22Bug%20reported%20by%20<%= loggedInUser.id %>!%22&idList=616863d9071f1c88feb22769">reporting a bug</a>.</em></p>
       <% } %>
      </div>
    <% } %>

  <% if (member.hasWishlist) { %>
    <% if (locals.loggedInUser && loggedInUser.id == member.id) { %>
      <div class="text-center">
        <p>
          <em>Click on an individual bird's wishlist indicator to cycle through the following options:</em>
        </p>
        <p>
          <span class="me-3">ğŸ¤  Not on wishlist</span>
          <span class="me-3">â¤ï¸  Wanted</span>
          <span class="me-3">ğŸŒŸ Needed</span>
        </p>

        <p class="small">
          <em>(<a href="/faq#wishlist">Wait, what is the wishlist and want vs. need for?</a>)</em>
        </p>
      </div>

      <div id="gottaWishlistEmAll" class="float-none float-md-end mt-5 mt-md-0 text-center">
        Add all birds on this page to: &nbsp;
        <span>
          <button data-action="want" class="btn btn-dark btn-sm" role="button">â¤ï¸</button>
          <button data-action="need" class="btn btn-dark btn-sm" role="button">ğŸŒŸ</button>
          <button data-action="none" class="btn btn-dark btn-sm" role="button">ğŸ¤</button>
        </span>
      </div>
    <% } %>

    <%- include('../partials/pagination.ejs') %>

    <div id="lazyLoader" class="row g-0" data-endpoint="wishlist" data-params='{"id":"<%= member.id  %>"}'></div>

    <%- include('../partials/pagination.ejs') %>

    <%- include('../scripts/lazyloader.ejs', { template: '../templates/wishlist.ejs', paginate: currentPage }) %>

    <% if (locals.loggedInUser && loggedInUser.id != member.id) { %>
      <%- include('../partials/wishlistModal.ejs') %>
    <% } %>
  <% } else { %>
    <% if (locals.loggedInUser && loggedInUser.id == member.id) { %>
      <p class="text-center"><em>You haven't added any birds to your wishlist yet!  You can do so by visiting <a href="/birdypedia">the Birdypedia</a> and clicking on the heart icons of birds you want!</em></p>
    <% } else { %>
      <p class="text-center"><em>This user hasn't added any birds to their wishlist... yet!</em></p>
    <% } %>
  <% } %>

  <script type="text/javascript">
    $(document).ready(function () {
      $('#useBait').on('click', function (event) {
        var button = this;

        if (!button.style.opacity) {
          button.style.opacity = .5;

          API.call('bait', 'POST', {}, function (data) {
              if (!data.error) {
                window.location.href = `/birdypet/${data}`;
              }
              else {
                button.innerText = data.error;
                button.disabled = true;
              }
          });
        }
      });

      $('#gottaWishlistEmAll').on('click', '.btn', function (event) {
        let button = event.target;
        let species = [];

        if (!button.style.opacity) { 
          $('.btn', '#gottaWishlistEmAll').css('opacity', .5);
          $('.wishlist-heart', '#lazyLoader').css('opacity', .5).html('â³');

          $('.wishlist-heart', '#lazyLoader').map((index, btn) => species.push(btn.getAttribute('data-id')));

          API.call('wishlist', 'POST', {
            action: button.getAttribute('data-action'),
            species: species,
          }, function (data) {
            $('.wishlist-heart', '#lazyLoader').css('opacity', '').html(data);
            $('.btn', '#gottaWishlistEmAll').css('opacity', '');
          });
        }
      });
    });
  </script>

<%- include('../footer.ejs') %>
